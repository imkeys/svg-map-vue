class svgMap{version="1.1.0";ts=16725024e5;selection=[];onSelected=()=>{};changeMap(t){if(document.querySelector("#wui-svg__map")){document.querySelector("#wui-svg__map").remove();this.init(t)}}constructor(t){this.SVG_NS="http://www.w3.org/2000/svg";let e={app:"#map",map:{},width:900,height:500,multiple:false,spot:{width:10,height:10,opacity:1,imgurl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAA/UlEQVQ4ja2UPW7CQBBGH4u5QFpIbzrSIyRamlzDl8hBuAgtEqJGVqQIeqBCcICQZaI1Y7TrHwKKP2klezzztDvzrVsiQkExMAFGwADoATsgBRbADNgEJQ7irUREVnJfK8271fmADxGxfwByWc0PIMkTAB+U5JD4gSPUydXFkTbxrdjdn+0cu19iT2vaL33a3SHR67iY5uomkU6hBPj+nMLlnL3bQ4o9fmXPFaCR0TEGcjvIATddztd4WQOjPgghp3VVcl28Z9RIgVwPqlQT3xl1YgjpDsF0wqDpXONlpZFa+d3/lDfvgemQ1Tfhk8Yc29jd8Xf09C3+//8E+AWtnj5RUfVN/AAAAABJRU5ErkJggg=="},label:{visible:false,fontSize:12,basicColor:"#ffffff",hoverColor:"#ffff00",clickColor:"#ffff00",opacity:.8},stroke:{width:1,color:"#ffffff",linejoin:"round",opacity:.2},fill:{basicColor:"#3f99f9",hoverColor:"#0880ff",clickColor:"#006bde",opacity:1},bar:{visible:true,maxWidth:200,backgroundColor:"rgba(255, 255, 255, .8)",opacity:1,padding:"8px 10px",border:{width:1,radius:5,color:"#dddddd",style:"solid"},font:{color:"#333333",size:12},offset:{x:20,y:10}},disabled:{except:false,backgroundColor:"#dddddd",fontColor:"#999999",name:[]}};e=this.merge(e,t);this.app=e.app;this.map=e.map;this.width=e.width;this.height=e.height;this.multiple=e.multiple;this.spot=e.spot;this.label=e.label;this.stroke=e.stroke;this.fill=e.fill;this.bar=e.bar;this.disabled=e.disabled;this.init(this.map)}init(h){if(this.ts<(new Date).getTime())return false;this.selection=[];this.$map=document.querySelector(this.app);this.$svg=document.createElementNS(this.SVG_NS,"svg");this.$svg.id="wui-svg__map";this.$svg.setAttribute("version","1.1");this.$svg.setAttribute("xmlns",this.SVG_NS);this.$svg.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`);this.$svg.setAttribute("width",this.width);this.$svg.setAttribute("height",this.height);this.$svg.style.position="relative";this.$svg.style.zIndex=1;const b=document.createElementNS(this.SVG_NS,"style");b.innerHTML=`
    #wui-svg__map {
      background: #f5f5f5;
    }
    `;this.$svg.appendChild(b);const c=document.createElementNS(this.SVG_NS,"defs");const t=document.createElementNS(this.SVG_NS,"image");t.id="icon";t.setAttribute("width",this.spot.width);t.setAttribute("height",this.spot.height);t.setAttribute("opacity",this.spot.opacity);t.setAttribute("href",this.spot.imgurl);c.appendChild(t);this.$svg.appendChild(c);for(let t in h){const{name:e,svg:f,textPosition:i,spotPosition:s}=h[t];const l=i&&Object.keys(i).length>0;const u=s&&Object.keys(s).length>0;const a=document.createElementNS(this.SVG_NS,"path");a.setAttribute("d",f);a.setAttribute("data-name",e);a.setAttribute("data-id",t);a.setAttribute("fill",this.fill.basicColor);a.setAttribute("fill-opacity",this.fill.opacity);a.setAttribute("data-fill-basic",this.fill.basicColor);a.setAttribute("data-fill-hover",this.fill.hoverColor);a.setAttribute("data-fill-click",this.fill.clickColor);a.setAttribute("stroke",this.stroke.color);a.setAttribute("stroke-width",this.stroke.width);a.setAttribute("stroke-opacity",this.stroke.opacity);a.setAttribute("stroke-linejoin",this.stroke.linejoin);a.style.cursor="pointer";a.style.transition="all .2s ease 0s";const r=document.createElementNS(this.SVG_NS,"use");if(u){const[o,n]=s;r.setAttribute("data-id",t);r.setAttribute("x",o);r.setAttribute("y",n);r.setAttribute("href","#icon");r.style.pointerEvents="none";r.style.transition="all .2s ease 0s"}const d=document.createElementNS(this.SVG_NS,"text");if(l){const[o,n]=i;d.setAttribute("data-id",t);d.setAttribute("x",o);d.setAttribute("y",n);d.setAttribute("fill",this.label.basicColor);d.setAttribute("data-fill-basic",this.label.basicColor);d.setAttribute("data-fill-hover",this.label.hoverColor);d.setAttribute("data-fill-click",this.label.clickColor);d.setAttribute("font-size",this.label.fontSize);d.setAttribute("opacity",this.label.opacity);d.style.pointerEvents="none";d.style.transition="all .2s ease 0s";d.innerHTML=e}if(this.disabled.name.length>0){if(~this.disabled.name.indexOf(t)){if(!this.disabled.except){a.setAttribute("data-disabled",true);d.setAttribute("data-disabled",true);r.setAttribute("data-disabled",true);a.setAttribute("fill",this.disabled.backgroundColor);d.setAttribute("fill",this.disabled.fontColor);a.style.cursor="not-allowed";r.style.filter="grayscale(1)"}else{a.addEventListener("mouseenter",this.handleMonseEnter.bind(this,a,d),false);a.addEventListener("mousemove",this.handleMonseMove.bind(this,a,d),false);a.addEventListener("mouseleave",this.handleMonseLeave.bind(this,a,d),false);a.addEventListener("click",this.handleClick.bind(this,a,d),false)}}else{if(this.disabled.except){a.setAttribute("data-disabled",true);d.setAttribute("data-disabled",true);r.setAttribute("data-disabled",true);a.setAttribute("fill",this.disabled.backgroundColor);d.setAttribute("fill",this.disabled.fontColor);a.style.cursor="not-allowed";r.style.filter="grayscale(1)"}else{a.addEventListener("mouseenter",this.handleMonseEnter.bind(this,a,d),false);a.addEventListener("mousemove",this.handleMonseMove.bind(this,a,d),false);a.addEventListener("mouseleave",this.handleMonseLeave.bind(this,a,d),false);a.addEventListener("click",this.handleClick.bind(this,a,d),false)}}}else{a.addEventListener("mouseenter",this.handleMonseEnter.bind(this,a,d),false);a.addEventListener("mousemove",this.handleMonseMove.bind(this,a,d),false);a.addEventListener("mouseleave",this.handleMonseLeave.bind(this,a,d),false);a.addEventListener("click",this.handleClick.bind(this,a,d),false)}this.$svg.appendChild(a);setTimeout(()=>{if(l)this.$svg.appendChild(d);if(u)this.$svg.appendChild(r)},1)}this.$map.appendChild(this.$svg)}handleMonseEnter(t,e,i){const s=t.getAttribute("data-id");const l=t.getAttribute("data-name");const a=t.getAttribute("data-fill-hover");const h=e.getAttribute("data-fill-hover");const b=t.getAttribute("data-fill-click");const c=e.getAttribute("data-fill-click");const f=this.selection.indexOf(s);if(~f){t.setAttribute("fill",b);e.setAttribute("fill",c)}else{t.setAttribute("fill",a);e.setAttribute("fill",h)}if(this.bar.visible){this.$bar=document.createElement("div");const r=document.createElement("div");r.style.backgroundColor=this.bar.backgroundColor;r.style.opacity=this.bar.opacity;r.style.padding=this.bar.padding;r.style.borderWidth=this.bar.border.width+"px";r.style.borderStyle=this.bar.border.style;r.style.borderColor=this.bar.border.color;r.style.borderRadius=this.bar.border.radius+"px";r.style.lineHeight=1.2;r.style.fontSize=this.bar.font.size+"px";r.innerHTML=`
        <div class="thead" style="padding: 0 0 5px; margin: 0 0 5px; border-bottom: 1px solid rgba(0, 0, 0, .1);">
          <h3>${l}</h3>
        </div>
        <dl class="tbody" style="line-height: 1.8;">
          <dd>加油站数量：100</dd>
          <dd>异常加油站数量：20</dd>
          <dd>异常占比：20%</dd>
          <dd>增值税申报营业额：2015456万</dd>
          <dd>疑似少申报额：2001万</dd>
        </dl>
      `;const{pageX:d,pageY:o}=i;const n=Number(this.getStyle(this.$svg,"zIndex"));this.$bar.id="wui-svg-bar";this.$bar.style.position="fixed";this.$bar.style.zIndex=n+1;this.$bar.style.left=d+this.bar.offset.x+"px";this.$bar.style.top=o+this.bar.offset.y+"px";this.$bar.style.transition="all .2s ease 0s";this.$bar.appendChild(r);document.body.appendChild(this.$bar)}}handleMonseMove(t,e,i){if(this.bar.visible){const{pageX:s,pageY:l}=i;this.$bar.style.left=s+this.bar.offset.x+"px";this.$bar.style.top=l+this.bar.offset.y+"px"}}handleMonseLeave(t,e){const i=t.getAttribute("data-id");const s=t.getAttribute("data-fill-basic");const l=e.getAttribute("data-fill-basic");const a=t.getAttribute("data-fill-click");const r=e.getAttribute("data-fill-click");const d=this.selection.indexOf(i);if(~d){t.setAttribute("fill",a);e.setAttribute("fill",r)}else{t.setAttribute("fill",s);e.setAttribute("fill",l)}if(this.bar.visible)this.$bar.remove()}handleClick(e,t){const i=e.getAttribute("data-id");const s=e.getAttribute("data-fill-basic");const l=t.getAttribute("data-fill-basic");const a=e.getAttribute("data-fill-click");const r=t.getAttribute("data-fill-click");e.setAttribute("fill",a);t.setAttribute("fill",r);const d=this.selection.indexOf(i);if(~d){this.selection.splice(d,1)}else{if(this.multiple){this.selection.push(i)}else{this.selection=[i];this.$svg.childNodes.forEach(t=>{if(t.getAttribute("data-disabled"))return false;if(t.nodeName==="path"){if(t.getAttribute("data-id")!==e.getAttribute("data-id")){t.setAttribute("fill",s)}}if(t.nodeName==="text"){if(t.getAttribute("data-id")!==e.getAttribute("data-id")){t.setAttribute("fill",l)}}})}}this.onSelected(this.selection)}getStyle(t,e){if(t.currentStyle){return t.currentStyle[e]}else{return document.defaultView.getComputedStyle(t,null)[e]}}merge(e,i){for(let t in e){if(t in i){if(typeof e[t]===typeof i[t]){if(typeof e[t]==="object"&&typeof e[t].length!=="number"&&t!=="map"){this.merge(e[t],i[t])}else{e[t]=i[t]}}}}return e}}